<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Status LED</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">
  <script src="worksheet-core.js"></script>
  <script src="worksheet-tracking.js"></script>
  <script defer src="shared-navigation.js"></script>
  <script defer src="pwa-install.js"></script>
</head>
<body>
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-4.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Worksheet</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 5 - Status LED</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-6.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> 1. Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>The Status LED shows what the system is doing. It lights up in different colours to show if things are working normally or if there is a problem. This makes it easier for maintenance teams to spot issues early, fix them quickly, and keep the system running safely and reliably.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/maintenance/ws5.png" alt="HMI System Maintenance">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>Follow these steps to explore the Status LED:</strong></p>

        <div class="steps-container">
          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Open Worksheet 5</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Navigate to Worksheet 5 on the HMI and locate the Status LED on your training system.</p>
            </div>
          </div>

          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Basic Mode</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Turn on the Basic Mode switch. Note the LED colour on-screen and on the physical rig (green for healthy, red for fault).</p>
            </div>
          </div>

          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>E-Stop Check</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press the E-Stop and observe the change in LED colour. Reset the E-Stop and confirm the LED returns to normal.</p>
            </div>
          </div>

          <div class="step-card" data-step="4">
            <div class="step-number">4</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Enhanced Mode</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Turn off Basic Mode and enable Enhanced Mode. Press Start and observe how the Status LED behaves with the motor running. Stop the motor when done.</p>
            </div>
          </div>

          <div class="step-card" data-step="5">
            <div class="step-number">5</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Live Process</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Enable Live Process Mode. Start the process and observe the LED while bottles pass on the conveyor. Activate Fast Processing and note LED behaviour for OK vs defective bottles.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="so-what-content">
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-cogs"></i>
            <h3>Why this matters</h3>
          </div>
          <div class="card-content">
            <p>In industry, you’ll need to know how to read a system’s status at a glance. Status LEDs are one of the fastest ways to do that. Whether the machine is healthy, starting up, running, or in fault, the colour and flashing pattern of the LED can tell you a lot if you know what to look for. These modes are examples, not universal standards—always read the machine manual and understand how the LED is controlled by the PLC.</p>
          </div>
        </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-eye"></i>
            <h3>Reading the LED correctly</h3>
          </div>
          <div class="card-content">
            <p>Green usually means normal, yellow means warning, and red means a fault. Flashing often shows an active condition or a more urgent state. Always confirm with the HMI or manual.</p>
          </div>
        </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-toolbox"></i>
            <h3>Using LEDs for diagnosis</h3>
          </div>
          <div class="card-content">
            <p>If the LED changes to warning or fault, check recent alarms, IO status, and what just changed in the process. Use the LED as a quick starting point, not the only check.</p>
          </div>
        </div>
      </div>

    </div>

    <!-- Key Takeaways Section -->
    <div class="worksheet-section key-takeaways-section">
      <h2 class="section-header"><i class="fas fa-list-check"></i> Key Takeaways</h2>
      <ul>
        <li>Status LEDs show machine state at a glance.</li>
        <li>Colours and flash rates mean different things.</li>
        <li>Modes shown here are examples, not official standards.</li>
        <li>Always check the machine manual and HMI.</li>
        <li>LED behaviour is set in the PLC program.</li>
        <li>Understanding LEDs helps with fault finding.</li>
      </ul>
    </div>

    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Questions & Answers</h2>
      <div class="questions-content">
        <div class="question-item" data-question="1">
          <h4>Question 1: What is the purpose of the status LED in a PLC system?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-1" value="A" class="option-radio">
              <span class="option-text">A) To measure system temperature</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="B" class="option-radio">
              <span class="option-text">B) To control the system automatically</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="C" class="option-radio">
              <span class="option-text">C) To provide power to the system</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="D" class="option-radio">
              <span class="option-text">D) It shows the current state of the system using colours, helping identify faults or normal operation</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(1)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> D) It shows the current state of the system using colours, helping identify faults or normal operation.
          </div>
        </div>
        
        <div class="question-item" data-question="2">
          <h4>Question 2: What does a red status LED usually mean?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-2" value="A" class="option-radio">
              <span class="option-text">A) It often means there is a fault or the emergency stop has been pressed</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="B" class="option-radio">
              <span class="option-text">B) It means the system is operating normally</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="C" class="option-radio">
              <span class="option-text">C) It means the system is starting up</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="D" class="option-radio">
              <span class="option-text">D) It means the system is shutting down</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(2)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) It often means there is a fault or the emergency stop has been pressed.
          </div>
        </div>
        
        <div class="question-item" data-question="3">
          <h4>Question 3: What does a green status LED usually mean?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-3" value="A" class="option-radio">
              <span class="option-text">A) It usually means there is a fault</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="B" class="option-radio">
              <span class="option-text">B) It usually means the system is healthy and ready or running normally</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="C" class="option-radio">
              <span class="option-text">C) It means the system is shutting down</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="D" class="option-radio">
              <span class="option-text">D) It means the system is starting up</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(3)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) It usually means the system is healthy and ready or running normally.
          </div>
        </div>
        
        <div class="question-item" data-question="4">
          <h4>Question 4: How does the status LED change across Basic, Enhanced, and Live Process modes?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-4" value="A" class="option-radio">
              <span class="option-text">A) It stays the same colour always</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="B" class="option-radio">
              <span class="option-text">B) It stays the same colour always</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="C" class="option-radio">
              <span class="option-text">C) It may show solid or flashing patterns based on system state, like startup, running, or fault</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="D" class="option-radio">
              <span class="option-text">D) It only flashes red</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(4)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> C) It may show solid or flashing patterns based on system state, like startup, running, or fault.
          </div>
        </div>
        
        <div class="question-item" data-question="5">
          <h4>Question 5: Why is it important to understand how the LED is programmed?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-5" value="A" class="option-radio">
              <span class="option-text">A) Because it controls the motor directly</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="B" class="option-radio">
              <span class="option-text">B) Because it saves energy</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="C" class="option-radio">
              <span class="option-text">C) Because LED behaviour is set in the PLC code and can vary between machines, so reading the manual and understanding the logic is key</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="D" class="option-radio">
              <span class="option-text">D) Because it changes colour with time of day</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(5)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> C) Because LED behaviour is set in the PLC code and can vary between machines, so reading the manual and understanding the logic is key.
          </div>
        </div>
      </div>
    </div>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      loadSavedAnswers();
    });
    
        function submitAnswer(questionNumber) {
          const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
          if (!answerInput) return;
          
          const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
          if (!selectedOption) {
            alert('Please select an answer before submitting.');
            return;
          }
          
          const answer = selectedOption.value;
          
          // Save with enhanced tracking
          worksheetTracker.saveAnswer(5, questionNumber, answer, 'maintenance');
          
          // Define correct answers for worksheet 5
          const correctAnswers = {
                "1": "B",
                "2": "D",
                "3": "A",
                "4": "C",
                "5": "B"
          };
          
          // Apply visual feedback
          const allOptions = answerInput.querySelectorAll('.option-label');
          const correctAnswer = correctAnswers[questionNumber];
          
          allOptions.forEach(option => {
            const radio = option.querySelector('.option-radio');
            const optionValue = radio.value;
            
            if (optionValue === correctAnswer) {
              option.classList.add('correct');
            } else if (optionValue === answer && answer !== correctAnswer) {
              option.classList.add('incorrect');
            }
          });
          
          // Mark question as submitted to disable further interaction
          answerInput.classList.add('submitted');
          
          // Show feedback on button
          const submitBtn = answerInput.querySelector('.submit-question-btn');
          if (submitBtn) {
            const originalText = submitBtn.textContent;
            submitBtn.textContent = answer === correctAnswer ? 'Correct!' : 'Incorrect!';
            submitBtn.style.background = answer === correctAnswer ? '#4CAF50' : '#f44336';
            
            // Add incorrect class for enhanced styling
            if (answer !== correctAnswer) {
              submitBtn.classList.add('incorrect');
            }
            
            setTimeout(() => {
              submitBtn.textContent = originalText;
              submitBtn.style.background = '#4CAF50';
              submitBtn.classList.remove('incorrect');
            }, 2000);
          }
          
          // Show correct answer if available
          const correctAnswerDiv = answerInput.querySelector('.correct-answer');
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
    function loadSavedAnswers() {
      // This function is now handled by the tracking system
    }
  </script>
  
  <!-- Bottom Navigation -->
  <div class="worksheet-bottom-nav">
    <div class="worksheet-header-content">
      <div class="worksheet-header-left">
        <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-4.html'">
          <i class="fas fa-arrow-left"></i>
          <span>Previous Worksheet</span>
        </button>
      </div>
       <div class="worksheet-header-center">
       <h1 class="worksheet-title">Worksheet 5 - Status LED</h1>
      </div>
      <div class="worksheet-header-right">
        <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-6.html'">
          <span>Next Worksheet</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
  
<script>

// Enhanced answer handling functions
function submitAnswer(questionNumber) {
  const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
  if (!answerInput) return;
  
  const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
  if (!selectedOption) {
    alert('Please select an answer before submitting.');
    return;
  }
  
  const answer = selectedOption.value;
  
  // Save with enhanced tracking if available
  if (typeof worksheetTracker !== 'undefined') {
    const worksheetId = getUrlParameter('id') || getWorksheetIdFromUrl();
    const path = window.location.pathname;
    const isFaultScenario = path.includes('fault-scenario');
    const type = getUrlParameter('type') || (isFaultScenario ? 'fault' : 'maintenance');
    worksheetTracker.saveAnswer(worksheetId, questionNumber, answer, type);
  } else {
    saveAnswer(questionNumber, answer);
  }
  
  // Get correct answer from the correct-answer div
  const correctAnswerDiv = answerInput.querySelector('.correct-answer');
  let correctAnswerText = '';
  if (correctAnswerDiv) {
    const strongElement = correctAnswerDiv.querySelector('strong');
    if (strongElement) {
      correctAnswerText = strongElement.nextSibling.textContent.trim();
    }
  }
  
  // Determine if answer is correct (extract letter from correct answer)
  const correctLetterMatch = correctAnswerText.match(/^([A-D])\)/);
  const correctLetter = correctLetterMatch ? correctLetterMatch[1] : null;
  const isCorrect = !!correctLetter && answer === correctLetter;
  
  // Style the selected option
  const allOptions = answerInput.querySelectorAll('.option-label');
  allOptions.forEach(option => {
    option.classList.remove('correct', 'incorrect');
  });
  
  if (isCorrect) {
    selectedOption.closest('.option-label').classList.add('correct');
  } else {
    selectedOption.closest('.option-label').classList.add('incorrect');
    // Also mark the correct option as correct
    const correctOption = answerInput.querySelector(`input[name="question-${questionNumber}"][value="${correctLetter}"]`);
    if (correctOption) {
      correctOption.closest('.option-label').classList.add('correct');
    }
  }
  
  const submitBtn = answerInput.querySelector('.submit-question-btn');
  if (submitBtn) {
    submitBtn.textContent = isCorrect ? 'Correct!' : 'Incorrect';
    submitBtn.style.background = isCorrect ? '#4CAF50' : '#f44336';
    setTimeout(() => {
      submitBtn.textContent = 'Submit Answer';
      submitBtn.style.background = '#4CAF50';
    }, 2000);
  }
  
  // Show correct answer
  if (correctAnswerDiv) {
    correctAnswerDiv.style.display = 'block';
  }
}


// Enhanced step tracking functions
function initializeStepTracking() {
  console.log('Initializing step tracking...');
  
  // Add flag to prevent double execution
  let isProcessing = false;
  
  // Wait a bit to ensure DOM is ready
  setTimeout(() => {
    const stepCards = document.querySelectorAll('.step-card');
    console.log('Found', stepCards.length, 'step cards');
    
    stepCards.forEach((card, index) => {
      const checkbox = card.querySelector('.step-complete-checkbox');
      const stepNumber = card.getAttribute('data-step') || (index + 1);
      
      console.log('Setting up card', stepNumber, 'with checkbox:', !!checkbox);
      
      if (checkbox) {
        // Load saved state
        const savedState = localStorage.getItem(`step-${stepNumber}`);
        if (savedState === 'true') {
          checkbox.checked = true;
          card.classList.add('step-completed');
          // Apply the completed styles
          card.style.background = '#2a2a2a';
          card.style.opacity = '0.7';
          card.style.cursor = 'default';
        }
        
        // Make the entire card clickable
        card.style.cursor = 'pointer';
        card.style.position = 'relative';
        card.style.zIndex = '1';
        
        // Add click handler to the entire card
        card.addEventListener('click', function(e) {
          console.log('Card clicked:', stepNumber);
          
          // Prevent double execution
          if (isProcessing) {
            console.log('Already processing, ignoring click');
            return;
          }
          
          // Don't toggle if clicking directly on the checkbox or its label
          if (e.target === checkbox || 
              e.target.closest('.step-checkbox') || 
              e.target.closest('label') ||
              e.target.tagName === 'INPUT' ||
              e.target.tagName === 'LABEL') {
            console.log('Clicking on checkbox or label, not toggling card');
            return;
          }
          
          // Prevent the default checkbox behavior and stop propagation
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          // Set processing flag
          isProcessing = true;
          
          // Toggle the checkbox directly without triggering events
          checkbox.checked = !checkbox.checked;
          
          // Manually call the change handler
          handleCheckboxChange(checkbox, card, stepNumber);
          
          console.log('Checkbox toggled to:', checkbox.checked);
          console.log('Card classes after toggle:', card.className);
          
          // Reset processing flag after a short delay
          setTimeout(() => {
            isProcessing = false;
          }, 100);
        });
        
        // Create a shared change handler function
        function handleCheckboxChange(checkbox, card, stepNumber) {
          console.log('Checkbox changed:', stepNumber, 'checked:', checkbox.checked);
          
          if (checkbox.checked) {
            card.classList.add('step-completed');
            // Force the styles to apply
            card.style.background = '#2a2a2a';
            card.style.opacity = '0.7';
            card.style.cursor = 'default';
            console.log('Added step-completed class to card', stepNumber);
            console.log('Card classes after adding:', card.className);
            localStorage.setItem(`step-${stepNumber}`, 'true');
          } else {
            card.classList.remove('step-completed');
            // Reset the styles
            card.style.background = '';
            card.style.opacity = '';
            card.style.cursor = 'pointer';
            console.log('Removed step-completed class from card', stepNumber);
            console.log('Card classes after removing:', card.className);
            localStorage.setItem(`step-${stepNumber}`, 'false');
          }
        }
        
        // Add change handler to checkbox
        checkbox.addEventListener('change', function() {
          if (!isProcessing) {
            handleCheckboxChange(checkbox, card, stepNumber);
          }
        });
        
        // Also make the checkbox itself clickable
        checkbox.addEventListener('click', function(e) {
          e.stopPropagation(); // Prevent card click when clicking checkbox
          e.stopImmediatePropagation(); // Stop any other handlers
        });
      }
    });
  }, 100);
}

// Initialize when page loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeStepTracking);
} else {
  // DOM is already loaded
  initializeStepTracking();
}

// Also try again after a short delay to ensure everything is ready
setTimeout(initializeStepTracking, 500);


</script>
</body>
</html> 